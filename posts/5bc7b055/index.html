<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CMake菜谱（二） | 路双宁的博客</title><meta name="keywords" content="CMake"><meta name="author" content="路双宁"><meta name="copyright" content="路双宁"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="Chapter 3 在学习的过程中总结的关于python路径的一些问题 ubuntu中自带了python，我的ubuntu版本是20.04，python版本是3.8，但是不像自己编译安装一样，ubuntu把这个python安装到了很多的地方。 首先，默认是没有安装pip的，可以通过sudo apt install python3-pip来安装。 然后，再使用pip来安装python的一些模块的时候">
<meta property="og:type" content="article">
<meta property="og:title" content="CMake菜谱（二）">
<meta property="og:url" content="https://lushuangning.github.io/posts/5bc7b055/index.html">
<meta property="og:site_name" content="路双宁的博客">
<meta property="og:description" content="Chapter 3 在学习的过程中总结的关于python路径的一些问题 ubuntu中自带了python，我的ubuntu版本是20.04，python版本是3.8，但是不像自己编译安装一样，ubuntu把这个python安装到了很多的地方。 首先，默认是没有安装pip的，可以通过sudo apt install python3-pip来安装。 然后，再使用pip来安装python的一些模块的时候">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2022-01-06T03:02:57.000Z">
<meta property="article:modified_time" content="2024-12-26T05:09:44.161Z">
<meta property="article:author" content="路双宁">
<meta property="article:tag" content="CMake">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://lushuangning.github.io/posts/5bc7b055/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.4.2',
  algolia: {"appId":"NT7VBMEHNU","apiKey":"db90b9537944fac58a60e68f42c776cf","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: 路双宁","link":"链接: ","source":"来源: 路双宁的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: {"text":"图灵,麦卡锡,明斯基,冯·诺依曼,伯纳斯·李,香农,肯·汤普森,林纳斯·托瓦兹","fontSize":"15px"},
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2024-12-26 13:09:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'true'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><style type="text/css">#toggle-sidebar {bottom: 80px}</style><link rel="stylesheet" href="//at.alicdn.com/t/font_2149337_g9rq691k4pp.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"><script src="https://cdn.jsdelivr.net/gh/lushuangning/live2d-widget@latest/"></script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">105</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">58</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 画廊</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Chapter 3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E8%BF%87%E7%A8%8B%E4%B8%AD%E6%80%BB%E7%BB%93%E7%9A%84%E5%85%B3%E4%BA%8Epython%E8%B7%AF%E5%BE%84%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.</span> <span class="toc-text">在学习的过程中总结的关于python路径的一些问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chpater-3-1-%E6%A3%80%E6%B5%8B-Python-%E8%A7%A3%E9%87%8A%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">chpater 3.1 检测 Python 解释器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chapter-3-2-%E6%A3%80%E6%B5%8Bpython%E5%BA%93"><span class="toc-number">1.3.</span> <span class="toc-text">chapter 3.2 检测python库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chapter-3-3-%E6%A3%80%E6%B5%8BPython%E6%A8%A1%E5%9D%97%E5%92%8C%E5%8C%85"><span class="toc-number">1.4.</span> <span class="toc-text">chapter 3.3 检测Python模块和包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chapter-3-4-%E6%A3%80%E6%B5%8BBLAS%E5%92%8CLAPACK%E6%95%B0%E5%AD%A6%E5%BA%93"><span class="toc-number">1.5.</span> <span class="toc-text">chapter 3.4 检测BLAS和LAPACK数学库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chapter-3-5-3-6"><span class="toc-number">1.6.</span> <span class="toc-text">chapter 3.5-3.6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chapter-3-7-3-8"><span class="toc-number">1.7.</span> <span class="toc-text">chapter 3.7-3.8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.8.</span> <span class="toc-text"></span></a></li></ol></li></ol></div></div></div><header class="no-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">路双宁的博客</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 画廊</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav></header><main class="layout_post" id="content-inner"><article id="post"><div id="post-info"><div id="post-title"><div class="posttitle">CMake菜谱（二）</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-06T03:02:57.000Z" title="发表于 2022-01-06 11:02:57">2022-01-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-12-26T05:09:44.161Z" title="更新于 2024-12-26 13:09:44">2024-12-26</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><div class="post-content" id="article-container"><h1>Chapter 3</h1>
<h2 id="在学习的过程中总结的关于python路径的一些问题">在学习的过程中总结的关于python路径的一些问题</h2>
<p>ubuntu中自带了python，我的ubuntu版本是20.04，python版本是3.8，但是不像自己编译安装一样，ubuntu把这个python安装到了很多的地方。</p>
<p>首先，默认是没有安装<code>pip</code>的，可以通过<code>sudo apt install python3-pip</code>来安装。</p>
<p>然后，再使用<code>pip</code>来安装python的一些模块的时候，这些模块被安装到的路径是由<code>USER_SITE</code>变量来决定的。可以通过<code>python3 -m site</code>来查看这些信息。比如我的就是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~ ❯ python3 -m site               </span><br><span class="line">sys.path = [</span><br><span class="line">    &#x27;/home/lushuangning&#x27;,</span><br><span class="line">    &#x27;/usr/lib/python38.zip&#x27;,</span><br><span class="line">    &#x27;/usr/lib/python3.8&#x27;,</span><br><span class="line">    &#x27;/usr/lib/python3.8/lib-dynload&#x27;,</span><br><span class="line">    &#x27;/home/lushuangning/.local/lib/python3.8/site-packages&#x27;,</span><br><span class="line">    &#x27;/usr/local/lib/python3.8/dist-packages&#x27;,</span><br><span class="line">    &#x27;/usr/lib/python3/dist-packages&#x27;,</span><br><span class="line">]</span><br><span class="line">USER_BASE: &#x27;/home/lushuangning/.local&#x27; (exists)</span><br><span class="line">USER_SITE: &#x27;/home/lushuangning/.local/lib/python3.8/site-packages&#x27; (exists)</span><br><span class="line">ENABLE_USER_SITE: True</span><br></pre></td></tr></table></figure>
<p>因此，如果使用<code>pip install numpy</code>的话，numpy包会被安装在<code>/home/lushuangning/.local/lib/python3.8/site-packages</code>下面，而不是安装在python自带的模块<code>/usr/lib/python3/dist-packages</code>下，想要更改可以参考<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/puqian13/article/details/115963942">ubuntu下更改pip安装的模块路径</a></p>
<p>另外，python的include目录在<code>/usr/include/python3.8</code>，这也是下面<code>PYTHON_INCLUDE_DIR</code>指向的目录，而<code>PYTHON_LIBRARY</code>指向的是<code>/usr/lib/python3.8/config-3.8-x86_64-linux-gnu/libpython3.8.so</code></p>
<h2 id="chpater-3-1-检测-Python-解释器">chpater 3.1 检测 Python 解释器</h2>
<p>CMakeLists.txt</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.5</span> FATAL_ERROR)</span><br><span class="line"><span class="keyword">project</span>(recipe-<span class="number">01</span> LANGUAGES NONE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(PythonInterp REQUIRED)</span><br><span class="line"><span class="keyword">execute_process</span>(</span><br><span class="line">  <span class="keyword">COMMAND</span></span><br><span class="line">  <span class="variable">$&#123;PYTHON_EXECUTABLE&#125;</span> <span class="string">&quot;-c&quot;</span> <span class="string">&quot;print(&#x27;Hello, world!&#x27;)&quot;</span></span><br><span class="line">  RESULT_VARIABLE _status</span><br><span class="line">  OUTPUT_VARIABLE _hello_world</span><br><span class="line">  ERROR_QUIET</span><br><span class="line">  OUTPUT_STRIP_TRAILING_WHITESPACE</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;RESULT_VARIABLE is: $&#123;_status&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;OUTPUT_VARIABLE is: $&#123;_hello_world&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><code>find_package</code>是用于发现和设置包的CMake模块的命令。这些模块包含CMake命令，用于标识系统标准位置中的包。CMake模块文件称为<code> Find&lt;name&gt;.cmake</code>，当调用<code>find_package(&lt;name&gt;)</code>时，模块中的命令将会运行。</p>
<p>除了在系统上实际查找包模块之外，查找模块还会设置了一些有用的变量，反映实际找到了什么，也可以在自己的<code>CMakeLists.txt</code>中使用这些变量。对于Python解释器，相关模块为<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Kitware/CMake/blob/master/Modules/FindPythonInterp.cmake">FindPythonInterp.cmake</a>附带的设置了一些CMake变量:</p>
<ul>
<li><strong>PYTHONINTERP_FOUND</strong>：是否找到解释器</li>
<li><strong>PYTHON_EXECUTABLE</strong>：Python解释器到可执行文件的路径</li>
<li><strong>PYTHON_VERSION_STRING</strong>：Python解释器的完整版本信息</li>
<li><strong>PYTHON_VERSION_MAJOR</strong>：Python解释器的主要版本号</li>
<li><strong>PYTHON_VERSION_MINOR</strong> ：Python解释器的次要版本号</li>
<li><strong>PYTHON_VERSION_PATCH</strong>：Python解释器的补丁版本号</li>
</ul>
<p>可以强制CMake，查找特定版本的包。例如，要求Python解释器的版本大于或等于2.7：<code>find_package(PythonInterp 2.7)</code></p>
<p>可以强制满足依赖关系:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(PythonInterp REQUIRED)</span><br></pre></td></tr></table></figure>
<p><strong>TIPS</strong>:<em>CMake有很多查找软件包的模块。我们建议在CMake在线文档中查询<code>Find&lt;package&gt;.cmake</code>模块，并在使用它们之前详细阅读它们的文档。<code>find_package</code>命令的文档可以参考 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://cmake.org/cmake/help/latest/command/find_package.html">https://cmake.org/cmake/help/latest/command/find_package.html</a> 另外一个方法是浏览 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Kitware/CMake/tree/master/Modules">https://github.com/Kitware/CMake/tree/master/Modules</a> 中的CMake模块源代码——它们记录了模块使用的变量，以及模块可以在<code>CMakeLists.txt</code>中使用的变量。</em></p>
<p>软件包没有安装在标准位置时，CMake无法正确定位它们。尤其是，对于Python解释器来说，使用Anaconda的用户可能创建了多个Python环境。用户可以使用CLI的<code>-D</code>参数传递相应的选项，告诉CMake查看特定的位置。Python解释器可以使用以下配置:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cmake -D PYTHON_EXECUTABLE=/media/lushuangning/mount_disk/software/anaconda3/envs/detectron2/bin/python ..</span></span><br></pre></td></tr></table></figure>
<h2 id="chapter-3-2-检测python库">chapter 3.2 检测python库</h2>
<p><strong>勘误</strong></p>
<p>首先是<code>hello-embedded-python.c</code>里，有一行代码是</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PyRun_SimpleString(<span class="string">&quot;from time import time,ctime\n&quot;</span></span><br><span class="line">                  <span class="string">&quot;print &#x27;Today is&#x27;,ctime(time())\n&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>这样在python3下会报错的，应该修改为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PyRun_SimpleString(<span class="string">&quot;from time import time,ctime\n&quot;</span></span><br><span class="line">                  <span class="string">&quot;print(&#x27;Today is&#x27;,ctime(time()))\n&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>个人猜测原书和翻译上可能用的是python2中的print方法，一时没有改过来。完整的代码是</p>
<p><code>hello-embedded-python.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Python.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">  Py_SetProgramName(argv[<span class="number">0</span>]); <span class="comment">/* optional but recommended */</span></span><br><span class="line">  Py_Initialize();</span><br><span class="line">  PyRun_SimpleString(<span class="string">&quot;from time import time,ctime\n&quot;</span></span><br><span class="line">                    <span class="string">&quot;print(&#x27;Today is&#x27;,ctime(time()))\n&quot;</span>);</span><br><span class="line">  Py_Finalize();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其次，如果是用的Anaconda，那么直接<code>cmake --build .</code>也是会报错的，需要先指定<code>PYTHONHOME</code>和<code>PYTHON_EXECUTABLE</code>的路径，正确的流程是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line">cmake -D PYTHONHOME=/media/lushuangning/mount_disk/software/anaconda3/envs/detectron2 -D PYTHON_EXECUTABLE=/media/lushuangning/mount_disk/software/anaconda3/envs/detectron2/bin/python ..</span><br><span class="line">cmake --build .</span><br><span class="line">./hello-embedded-python</span><br></pre></td></tr></table></figure>
<p>完整的<code>CmakeLists.txt</code>代码如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.12</span> FATAL_ERROR)</span><br><span class="line"><span class="keyword">project</span>(recipe-<span class="number">02</span> LANGUAGES C)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_STANDARD <span class="number">99</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_EXTENSIONS <span class="keyword">OFF</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(PythonInterp REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(PythonLibs <span class="variable">$&#123;PYTHON_VERSION_MAJOR&#125;</span>.<span class="variable">$&#123;PYTHON_VERSION_MINOR&#125;</span> EXACT REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(hello-embedded-python hello-embedded-python.c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_include_directories</span>(hello-embedded-python</span><br><span class="line">  PRIVATE</span><br><span class="line">  <span class="variable">$&#123;PYTHON_INCLUDE_DIRS&#125;</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(hello-embedded-python</span><br><span class="line">  PRIVATE</span><br><span class="line">  <span class="variable">$&#123;PYTHON_LIBRARIES&#125;</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;PYTHONHOME is &quot;</span> <span class="variable">$&#123;PYTHONHOME&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>注：<code>find_package(PythonInterp REQUIRED)</code>已在Cmake 3.12以后的版本中废弃，替代的方式为<code>find_package(Python COMPONENTS Interpreter Development)</code></p>
<h2 id="chapter-3-3-检测Python模块和包">chapter 3.3 检测Python模块和包</h2>
<p>本示例演示如何通过Cmake找到Python的Numpy模块</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">execute_process</span>(</span><br><span class="line">  <span class="keyword">COMMAND</span></span><br><span class="line">    <span class="variable">$&#123;PYTHON_EXECUTABLE&#125;</span> <span class="string">&quot;-c&quot;</span> <span class="string">&quot;import re, numpy; print(re.compile(&#x27;/__init__.py.*&#x27;).sub(&#x27;&#x27;,numpy.__file__))&quot;</span></span><br><span class="line">  RESULT_VARIABLE _numpy_status</span><br><span class="line">  OUTPUT_VARIABLE _numpy_location</span><br><span class="line">  ERROR_QUIET</span><br><span class="line">  OUTPUT_STRIP_TRAILING_WHITESPACE</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>新命令</strong>：<code>execute_process</code>将作为子进程执行一个或多个命令。最后，子进程返回值将作为参数，传递给<code>RESULT_VARIABLE</code>，而管道标准输出和标准错误的内容将被保存到变量作为参数传递给<code>OUTPUT_VARIABLE</code>和<code>ERROR_VARIABLE</code>。<code>execute_process</code>可以执行任何操作，并使用它们的结果来推断系统配置。本例中，用它来确保NumPy可用，然后获得模块版本。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(FindPackageHandleStandardArgs)</span><br><span class="line"></span><br><span class="line">find_package_handle_standard_args(NumPy</span><br><span class="line">  FOUND_VAR NumPy_FOUND</span><br><span class="line">  REQUIRED_VARS NumPy</span><br><span class="line">  VERSION_VAR _numpy_version</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p><strong>新命令</strong>：<code>find_package_handle_standard_args</code>提供了用于处理与查找相关程序和库的标准工具。引用此命令时，可以正确的处理与版本相关的选项(<code>REQUIRED</code>和<code>EXACT</code>)，而无需更多的CMake代码。稍后将介绍<code>QUIET</code>和<code>COMPONENTS</code>选项。</p>
<p>所有必需的变量都设置为有效的文件路径(NumPy)后，发送到模块(<code>NumPy_FOUND</code>)。它还将版本保存在可传递的版本变量(<code>_numpy_version</code>)中并打印:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- Found NumPy: /usr/lib/python3.6/site-packages/numpy (found version &quot;1.14.3&quot;)</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">  OUTPUT</span><br><span class="line">    <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/use_numpy.py</span><br><span class="line">  <span class="keyword">COMMAND</span></span><br><span class="line">    <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E copy_if_different <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/use_numpy.py</span><br><span class="line">    <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/use_numpy.py</span><br><span class="line">  DEPENDS</span><br><span class="line">    <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/use_numpy.py</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>新命令</strong>：<code>add_custom_command</code>，将在第5章详细讨论。</p>
<p>完整的执行命令及结果为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~/CodeHub/CMake/MyCmakeExample/chapter3/3.3/build main ?1                      </span><br><span class="line">❯ cmake -D PYTHON_INCLUDE_DIR=/usr/include/python3.8 -D PYTHON_LIBRARY=/usr/lib/python3.8/config-3.8-x86_64-linux-gnu/libpython3.8.so ..</span><br><span class="line">-- The CXX compiler identification is GNU 9.4.0</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Found PythonInterp: /usr/bin/python3.8 (found version &quot;3.8.10&quot;) </span><br><span class="line">-- Found PythonLibs: /usr/lib/python3.8/config-3.8-x86_64-linux-gnu/libpython3.8.so (found suitable exact version &quot;3.8.10&quot;) </span><br><span class="line">-- Found NumPy: /home/lushuangning/.local/lib/python3.8/site-packages/numpy (found version &quot;1.22.3&quot;) </span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/lushuangning/CodeHub/CMake/MyCmakeExample/chapter3/3.3/build</span><br></pre></td></tr></table></figure>
<h2 id="chapter-3-4-检测BLAS和LAPACK数学库">chapter 3.4 检测BLAS和LAPACK数学库</h2>
<p>这篇示例需要提前安装gfortran，BLAS库，LAPACK库，安装命令为<code>sudo apt install gfortran libblas-dev liblapack-dev liblapack-doc</code></p>
<p><strong>我们首先明确，这个系列的博客是在学习CMake的用法，而不是Python、Fortran或者其他什么语言的用法，注意不要本末倒置。</strong> 这里我们把用到的文件从对应的github上下载下来即可，重点关注的是<code>CMakeLists.txt</code>文件，而这其中，构建过程的重点代码又如下所示：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(<span class="keyword">math</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_sources</span>(<span class="keyword">math</span></span><br><span class="line">  PRIVATE</span><br><span class="line">    CxxBLAS.cpp</span><br><span class="line">    CxxLAPACK.cpp</span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line"><span class="keyword">target_include_directories</span>(<span class="keyword">math</span></span><br><span class="line">  PUBLIC</span><br><span class="line">    <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span></span><br><span class="line">    <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span></span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="keyword">math</span></span><br><span class="line">  PUBLIC</span><br><span class="line">  	<span class="variable">$&#123;LAPACK_LIBRARIES&#125;</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(linear-algebra <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_sources</span>(linear-algebra</span><br><span class="line">  PRIVATE</span><br><span class="line">    linear-algebra.cpp</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(linear-algebra</span><br><span class="line">  PRIVATE</span><br><span class="line">    <span class="keyword">math</span></span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p>理清楚这个顺序很重要。首先，<code>add_library</code>生成一个<code>math</code>的链接文件，该文件依赖的cpp文件由<code>target_sources</code>指定，包含的头文件由<code>target_include_directories</code>指定，需要用到的库由<code>target_link_libraries</code>指定。</p>
<p>然后，可执行文件<code>linear-algebra</code>需要的cpp文件由<code>target_sources</code>指定，需要用到的库即是上一步生成的链接文件math，由<code>target_link_libraries</code>指定。</p>
<h2 id="chapter-3-5-3-6">chapter 3.5-3.6</h2>
<p>chapter 3.5和3.6需要用到OpenMP，但是其安装较为繁琐，而且我目前的技术栈用不到它。还是那句话，我们当前的目的是学习CMake，这两节的<code>CMakeLists.txt</code>很简单，并且没有出现新的CMake命令，因此选择跳过这两节。</p>
<h2 id="chapter-3-7-3-8">chapter 3.7-3.8</h2>
<p>这两节里面出现了一个很重要的知识点，即<code>find_package</code>查找的两种方式。CMake的官方文档中也给出了这两种方式的说明：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://cmake.org/cmake/help/latest/command/find_package.html">https://cmake.org/cmake/help/latest/command/find_package.html</a></p>
<p>为此，不惜直接将官网上的这两段重点复制过来</p>
<hr>
<p><strong>Module mode</strong></p>
<p>In this mode, CMake searches for a file called <code>Find&lt;PackageName&gt;.cmake</code>, looking first in the locations listed in the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://cmake.org/cmake/help/latest/variable/CMAKE_MODULE_PATH.html#variable:CMAKE_MODULE_PATH">CMAKE_MODULE_PATH</a>, then among the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://cmake.org/cmake/help/latest/manual/cmake-developer.7.html#find-modules">Find Modules</a> provided by the CMake installation. If the file is found, it is read and processed by CMake. It is responsible for finding the package, checking the version, and producing any needed messages. Some Find modules provide limited or no support for versioning; check the Find module’s documentation.</p>
<p>The <code>Find&lt;PackageName&gt;.cmake</code> file is not typically provided by the package itself. Rather, it is normally provided by something external to the package, such as the operating system, CMake itself, or even the project from which the <code>find_package()</code> command was called. <strong>Being externally provided, Find Modules tend to be heuristic in nature and are susceptible to becoming out-of-date. They typically search for certain libraries, files and other package artifacts.</strong></p>
<p>Module mode is only supported by the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://cmake.org/cmake/help/latest/command/find_package.html#basic-signature">basic command signature</a>.</p>
<p><strong>Config mode</strong></p>
<p>In this mode, CMake searches for a file called <code>&lt;lowercasePackageName&gt;-config.cmake</code> or <code>&lt;PackageName&gt;Config.cmake</code>. It will also look for <code>&lt;lowercasePackageName&gt;-config-version.cmake</code> or <code>&lt;PackageName&gt;ConfigVersion.cmake</code> if version details were specified (see <a target="_blank" rel="noopener external nofollow noreferrer" href="https://cmake.org/cmake/help/latest/command/find_package.html#version-selection">Config Mode Version Selection</a> for an explanation of how these separate version files are used).</p>
<p>In config mode, the command can be given a list of names to search for as package names. The locations where CMake searches for the config and version files is considerably more complicated than for Module mode (see <a target="_blank" rel="noopener external nofollow noreferrer" href="https://cmake.org/cmake/help/latest/command/find_package.html#search-procedure">Config Mode Search Procedure</a>).</p>
<p><strong>The config and version files are typically installed as part of the package, so they tend to be more reliable than Find modules</strong>. They usually contain direct knowledge of the package contents, so no searching or heuristics are needed within the config or version files themselves.</p>
<p>Config mode is supported by both the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://cmake.org/cmake/help/latest/command/find_package.html#basic-signature">basic</a> and <a target="_blank" rel="noopener external nofollow noreferrer" href="https://cmake.org/cmake/help/latest/command/find_package.html#full-signature">full</a> command signatures.</p>
<hr>
<p>找不到依赖是CMake报错的重灾区，了解CMake如何找到依赖是非常重要的，可参考<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.jianshu.com/p/39fc5e548310">深入理解CMake(3):find_package()的使用</a>对这两种模式有一个大致的了解。</p>
<h2 id=""></h2>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">路双宁</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lushuangning.github.io/posts/5bc7b055/">https://lushuangning.github.io/posts/5bc7b055/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lushuangning.github.io" target="_blank">路双宁的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CMake/">CMake</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechatpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechatpay.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/40df9206/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">左神算法基础班第三周</div></div></a></div><div class="next-post pull-right"><a href="/posts/f8e49d55/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CMake菜谱（一）</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2024 By 路双宁</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    const initData = {
      el: '#vcomment',
      appId: 'VMqnI9pLmxxHTgJswVD4NG7b-gzGzoHsz',
      appKey: 'IIEWxiiBotI5HSnW0J416lsU',
      placeholder: '快来评论吧',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }

    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="aplayer no-destroy" data-id="003B4aet4U1Flz" data-server="tencent" data-type="song" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config_change',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  $('script[data-pjax]').each(function () {
    $(this).parent().append($(this).remove())
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', '', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  $(window).off('scroll')

  //reset readmode
  $('body').hasClass('read-mode') && $('body').removeClass('read-mode')

})</script></div></body></html>